{{#if (eq payments "polar")}}
import { httpRouter } from "convex/server";
import { polar } from "./polar";
import type { WebhookSubscriptionCreatedPayload } from "@polar-sh/sdk/models/components/webhooksubscriptioncreatedpayload.js";
import type { WebhookSubscriptionUpdatedPayload } from "@polar-sh/sdk/models/components/webhooksubscriptionupdatedpayload.js";

const http = httpRouter();

// Register Polar webhook handler at /polar/events
polar.registerRoutes(http, {
	onSubscriptionCreated: async (_ctx, event: WebhookSubscriptionCreatedPayload) => {
		console.log("New subscription:", event.data.id);
	},
	onSubscriptionUpdated: async (_ctx, event: WebhookSubscriptionUpdatedPayload) => {
		if (event.data.canceledAt) {
			console.log("Subscription canceled:", event.data.id);
		}
	},
});

export default http;
{{/if}}
