import "reflect-metadata";
import { DataSource } from "typeorm";
import { env } from "@{{projectName}}/env/server";

export const AppDataSource = new DataSource({
	type: "better-sqlite3",
	database: env.DATABASE_URL.replace("file:", ""),
	synchronize: true,
	logging: false,
	entities: ["src/entities/**/*.ts"],
	migrations: ["src/migrations/**/*.ts"],
	subscribers: ["src/subscribers/**/*.ts"],
});

export const initializeDatabase = async () => {
	if (!AppDataSource.isInitialized) {
		await AppDataSource.initialize();
	}
	return AppDataSource;
};

export const db = AppDataSource;
