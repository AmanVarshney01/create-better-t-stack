import { g, buildSchema, type InferResolvers, queryType, mutationType } from "../index";
import type { Context } from "../context";

export function createResolvers(ctx: Context): InferResolvers<{ Query: typeof queryType; Mutation: typeof mutationType }, { context: Context }> {
  return {
    Query: {
      health: () => "OK",
{{#if (eq auth "better-auth")}}
      privateData: () => {
        if (!ctx.session) {
          return null;
        }
        return {
          message: "This is private data",
          user: ctx.session.user,
        };
      },
{{/if}}
    },
    Mutation: {
      _empty: () => null,
    },
  };
}

export function createSchema(ctx: Context) {
  const resolvers = createResolvers(ctx);
  return buildSchema({ g, resolvers });
}
