import { createClerkHandler } from "@clerk/tanstack-react-start/server";
import {
	createStartHandler,
	defaultStreamHandler,
	defineHandlerCallback,
} from "@tanstack/react-start/server";
import { createRouter } from "./router";

// this is broken right now, waiting for a fix
const handlerFactory = createClerkHandler(
	createStartHandler({
		createRouter,
	}),
);

export default defineHandlerCallback(async (event) => {
	const startHandler = await handlerFactory(defaultStreamHandler);
	return startHandler(event);
});
