import { orpc } from '../lib/orpc';
import { useQuery } from '@tanstack/react-query';
import { QueryClientProvider } from '@tanstack/react-query';
import { queryClient } from '../shared/query';

function ApiStatus() {
	const healthCheck = useQuery(orpc.healthCheck.queryOptions());

	return (
		<section className="rounded-lg border p-4">
			<h2 className="mb-2 font-medium">API Status</h2>
			<div className="flex items-center gap-2">
				<div 
					className={`h-2 w-2 rounded-full ${
						healthCheck.data ? "bg-green-500" : "bg-red-500"
					}`}
				></div>
				<span className="text-muted-foreground text-sm">
					{healthCheck.isLoading
						? "Checking..."
						: healthCheck.data
						? "Connected"
						: "Disconnected"}
				</span>
			</div>
			{healthCheck.data && (
				<div className="mt-2 text-sm text-green-600">
					Response: {JSON.stringify(healthCheck.data)}
				</div>
			)}
		</section>
	);
}

export function OrpcApiStatus() {
	return (
		<QueryClientProvider client={queryClient}>
			<ApiStatus />
		</QueryClientProvider>
	);
}