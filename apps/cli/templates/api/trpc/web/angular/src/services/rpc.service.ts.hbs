import { Injectable } from "@angular/core";
import { createTRPCClient, httpBatchLink } from "@trpc/client";
import type { AppRouter } from "../../../server/src/routers/index";
import { QueryClient, QueryCache } from "@tanstack/angular-query-experimental";
import { toast } from "ngx-sonner";
export const queryClient = new QueryClient({
 queryCache: new QueryCache({
   onError: (error) => {
     toast.error(error.message, {
       action: {
         label: "retry",
         onClick: () => {
           queryClient.invalidateQueries();
         },
       },
     });
   },
 }),
});

@Injectable({
 providedIn: "root",
})
export class RpcService {
 public proxy = createTRPCClient<AppRouter>({
  links: [
   httpBatchLink({
    url: "http://localhost:3000/trpc",
    fetch: (url, options) => {
     return fetch(url, {
      ...options,
      credentials: "include",
     });
    },
   }),
  ],
 });
}
