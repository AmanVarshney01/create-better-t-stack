# Ralphy Configuration
# https://github.com/michaelshimeles/ralphy

# Project info
project:
  name: "better-fullstack"
  language: "TypeScript"
  framework: "TanStack Start, Convex, Bun"
  description: "Full-stack CLI scaffolding tool - fork of Better-T-Stack for creating full-stack projects"

# Commands
commands:
  test: "bun test"
  lint: "bun run check"
  build: "bun run build"

# Rules - instructions the AI MUST follow
# These are injected into every prompt
rules:
  # Core philosophy
  - "This is a full-stack CLI tool for creating full-stack projects. Every new library, framework, or language added MUST be tested with comprehensive tests before moving to the next task."
  - "Never ask for user confirmation or commands. Execute everything autonomously. If something fails, fix it and retry."
  - "Write the BEST possible tests for any new functionality - unit tests, integration tests, and E2E tests where applicable."

  # CLI + Builder Sync (CRITICAL)
  - |
    When adding ANY new library, option, or category, you MUST update BOTH the CLI AND the web Builder.

    For CLI (apps/cli/):
    1. packages/types/src/schemas.ts - Add schema (e.g., CMSSchema = z.enum([...]))
    2. packages/types/src/index.ts - Export the new type
    3. apps/cli/src/index.ts - Add to router schema with .optional().describe()
    4. apps/cli/src/prompts/{category}.ts - Create interactive prompt file
    5. apps/cli/src/prompts/config-prompts.ts - Wire the prompt in navigableGroup and return object

    For Builder (apps/web/):
    1. apps/web/src/lib/constant.ts - Add to StackState type and DEFAULT_STACK, add options to TECH_OPTIONS
    2. apps/web/src/lib/stack-url-keys.ts - Add short URL key mapping (e.g., forms: "frm")
    3. apps/web/src/lib/stack-search-schema.ts - Add to Zod schema
    4. apps/web/src/lib/stack-url-state.ts - Add to parseSync and serializeStackParams
    5. apps/web/src/lib/stack-url-state.client.ts - Add to searchToStack function
    6. apps/web/src/lib/stack-utils.ts - Add to generateStackCommand flags and TYPESCRIPT_CATEGORY_ORDER

    The CLI command generated by the Builder MUST match what the CLI accepts. Test by:
    1. Building CLI: cd apps/cli && bun run build
    2. Running: bun run apps/cli/src/cli.ts --help (verify new flag appears)
    3. Testing interactive: bun run apps/cli/src/cli.ts (navigate through prompts)

  # Testing requirements
  - "When adding a new library/framework: 1) Add the dependency 2) Write tests proving it works 3) Run tests 4) Only proceed if tests pass"
  - "Use Bun's built-in test runner (bun test) for all tests"
  - "Test files should be colocated with source files as *.test.ts or in a __tests__ directory"
  - "Tests must cover: happy path, edge cases, error handling, and integration with existing code"

  # Tech stack rules
  - "Use Bun for all package management and scripts (not npm/yarn/pnpm)"
  - "Use TailwindCSS v4 syntax for styling (not v3)"
  - "Use TanStack Router file-based routing conventions for the web app"
  - "Use Convex patterns: query for reads, mutation for writes, action for external APIs"
  - "Use TypeScript strict mode - no 'any' types"

  # Code quality
  - "Run 'bun run check' (oxfmt + oxlint) before considering any task complete"
  - "Run 'bun run build' to verify the build passes"
  - "Follow existing patterns in the codebase - check similar files first"
  - "Keep components small and focused - split large components"

  # Monorepo structure
  - "CLI code goes in apps/cli/"
  - "Website code goes in apps/web/"
  - "Backend (Convex) code goes in packages/backend/convex/"
  - "Shared types go in packages/types/"
  - "Template generation logic goes in packages/template-generator/"

  # Git workflow
  - "Make atomic commits with clear messages"
  - "Commit after each completed story/task"

  # NPM Release workflow
  - |
    To publish a new version to npm, run: bun run bump
    This creates a PR with version bumps. When merged, GitHub Actions auto-publishes to npm.
    Packages published: create-better-fullstack, create-bfs, @better-fullstack/types, @better-fullstack/template-generator
    See AGENTS.md "Publishing to NPM" section for full details.

# Boundaries - files/folders the AI should not modify
boundaries:
  never_touch:
    - "*.lock"
    - "bun.lock"
    - "node_modules/**"
    - ".git/**"
    - "packages/backend/convex/_generated/**"
    - "apps/web/src/routeTree.gen.ts"
